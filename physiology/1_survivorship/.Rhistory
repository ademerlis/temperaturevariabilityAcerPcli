mutate(Removed_Date = ymd(Removed_Date)) %>%
mutate(start_date="2022-06-25") %>%
mutate(start_date = ymd(start_date)) %>%
mutate(days_to_removed = Removed_Date - start_date) %>%
filter(!days_to_removed == "NA days") %>%
group_by(Species, Treatment, CBASS_temp, Colony) %>%
summarise(averagedays = mean(days_to_removed), se = std.error(days_to_removed)) %>%
ggplot(., aes(x = CBASS_temp, y = averagedays, fill = Treatment)) +
geom_bar(stat="identity", position = position_dodge()) +
geom_errorbar(aes(ymin = averagedays - se, ymax = averagedays + se), width =
.2, position=position_dodge(.9)) +
theme_classic() +
facet_wrap(~Species+Colony, scales = "free_x") +
scale_fill_manual(labels=c("Treated", "Untreated"), values = c("#F54A34", "#60DBDB")) +
labs(x="CBASS Temperature", y="Number of Days at 32ÂºC")
kruskal_test(days_to_removed ~ Species_Treatment, data = slowburn_summary_data)
dunn_test(days_to_removed ~ Species_Treatment, data = slowburn_summary_data)
treat_model <- lm(days_to_removed ~ Treatment*Species*Colony, data = slowburn_summary_data)
treat_model_metrics <- augment(treat_model)
plot(treat_model)
# assess normality of residuals using Shapiro-Wilk test
shapiro_test(treat_model_metrics$.resid) # significant
# assess homogeneity of variances using Levene's Test
levene_test(.resid ~ Treatment*Species, data = treat_model_metrics) #not significant
#make interaction term
slowburn_summary_data$Species_Treatment_Colony <- interaction(slowburn_summary_data$Species, slowburn_summary_data$Treatment, slowburn_summary_data$Colony)
#run Welch's anova
oneway.test(days_to_removed ~ Species_Treatment_Colony, data = slowburn_summary_data, var.equal = FALSE) #significant
slowburn_metadata %>%
filter(slowburn == "heatstress_32") %>%
filter(Removed_Date >= "2022-06-25" | is.na(Removed_Date)) %>%
mutate(Removed_Date = ymd(Removed_Date)) %>%
mutate(mortality_date = ymd(mortality_date)) %>%
mutate(end_date = coalesce(Removed_Date, mortality_date)) %>% #if removed_date is NA, then look and use the date from mortality date
mutate(start_date="2022-06-25") %>%
mutate(start_date = ymd(start_date)) %>%
mutate(days_to_removed = end_date - start_date)
Species_Treatment_Colony
slowburn_summary_data
slowburn_summary_data %>%
group_by(Species, Treatment, Colony) %>%
summarise(count = n())
slowburn_metadata %>%
filter(slowburn == "heatstress_32") %>%
filter(Removed_Date >= "2022-06-25" | is.na(Removed_Date)) %>%
mutate(Removed_Date = ymd(Removed_Date)) %>%
mutate(start_date="2022-06-25") %>%
mutate(start_date = ymd(start_date)) %>%
mutate(days_to_removed = Removed_Date - start_date) %>%
filter(!days_to_removed == "NA days") %>%
select(Species, ID, Colony, Treatment, CBASS_temp, slowburn, days_to_removed) -> slowburn_summary_data
slowburn_summary_data %>%
mutate_at(vars(Species, ID, Colony, Treatment, CBASS_temp), factor) %>%
mutate(days_to_removed = as.numeric(days_to_removed)) -> slowburn_summary_data
treat_model <- lm(days_to_removed ~ Treatment*Species*CBASS_temp + Colony, data = slowburn_summary_data)
treat_model_metrics <- augment(treat_model)
plot(treat_model)
# assess normality of residuals using Shapiro-Wilk test
shapiro_test(treat_model_metrics$.resid) # not significant
# assess homogeneity of variances using Levene's Test
levene_test(.resid ~ Treatment*Species*CBASS_temp, data = treat_model_metrics) #not significant
aov(days_to_removed ~ Treatment*Species*CBASS_temp, data = slowburn_summary_data)
summary(aov(days_to_removed ~ Treatment*Species*CBASS_temp, data = slowburn_summary_data))
slowburn_metadata %>%
filter(slowburn == "heatstress_32") %>%
filter(Removed_Date >= "2022-06-25") %>%
mutate(start_date="2022-06-25") %>%
mutate(start_date = ymd(start_date)) %>%
mutate(Removed_Date = ymd(Removed_Date)) %>%
mutate(days_to_removed = Removed_Date - start_date) %>%
mutate(days_to_removed = as.numeric(days_to_removed)) %>%
group_by(Species, Colony, Treatment) %>%
dplyr::summarise(mean=mean(days_to_removed), sd = sd(days_to_removed), n = n()) %>%
as.data.frame()
slowburn_metadata %>%
filter(slowburn == "heatstress_32") %>%
filter(Removed_Date >= "2022-06-25" | is.na(Removed_Date)) %>%
mutate(Reason_removed = case_when(Reason_removed == "dead" ~ "RTL",
Reason_removed == "RTL" ~ "RTL",
Reason_removed == "paling" ~ "bleached",
Reason_removed == "bleaching" ~ "bleached"))  %>%
ggplot(., aes(x=Reason_removed, y=count, fill = Treatment)) +
geom_col(position = position_dodge()) +
theme_classic() +
facet_wrap(~Species)  +
scale_fill_manual(labels=c("Treated", "Untreated"), values = c("#F54A34", "#60DBDB"))  +
theme(text = element_text(size = 15)) +
labs(x="Category", y="Number of corals")
slowburn_metadata %>%
filter(slowburn == "heatstress_32") %>%
filter(Removed_Date >= "2022-06-25" | is.na(Removed_Date)) %>%
mutate(Reason_removed = case_when(Reason_removed == "dead" ~ "RTL",
Reason_removed == "RTL" ~ "RTL",
Reason_removed == "paling" ~ "bleached",
Reason_removed == "bleaching" ~ "bleached"))
#run Welch's anova
oneway.test(days_to_removed ~ Species_Treatment, data = slowburn_summary_data, var.equal = FALSE) #significant
#make interaction term
slowburn_summary_data$Species_Treatment <- interaction(slowburn_summary_data$Species, slowburn_summary_data$Treatment)
#run Welch's anova
oneway.test(days_to_removed ~ Species_Treatment, data = slowburn_summary_data, var.equal = FALSE) #significant
#posthoc test: Games-Howell
slowburn_summary_data %>%
ungroup() %>%
games_howell_test(., days_to_removed ~ Species_Treatment)
slowburn_summary_data
summary(aov(days_to_removed ~ Treatment*Species*CBASS_temp, data = slowburn_summary_data))
slowburn_metadata %>%
filter(slowburn == "heatstress_32") %>%
filter(Removed_Date >= "2022-06-25" | is.na(Removed_Date)) %>%
mutate(Removed_Date = ymd(Removed_Date)) %>%
mutate(start_date="2022-06-25") %>%
mutate(start_date = ymd(start_date)) %>%
mutate(days_to_removed = Removed_Date - start_date) %>%
filter(!days_to_removed == "NA days") %>%
select(Species, ID, Colony, Treatment, CBASS_temp, slowburn, days_to_removed) -> slowburn_summary_data
slowburn_summary_data %>%
mutate_at(vars(Species, ID, Colony, Treatment, CBASS_temp), factor) %>%
mutate(days_to_removed = as.numeric(days_to_removed)) -> slowburn_summary_data
#make interaction term
slowburn_summary_data$Species_Treatment <- interaction(slowburn_summary_data$Species, slowburn_summary_data$Treatment)
#run Welch's anova
oneway.test(days_to_removed ~ Species_Treatment, data = slowburn_summary_data, var.equal = FALSE) #significant
slowburn_summary_data %>%
ungroup() %>%
games_howell_test(., days_to_removed ~ Species_Treatment)
#make interaction term
slowburn_summary_data$Species_Treatment <- interaction(slowburn_summary_data$Species, slowburn_summary_data$Treatment)
#run Welch's anova
oneway.test(days_to_removed ~ Species_Treatment, data = slowburn_summary_data, var.equal = FALSE) #significant
#posthoc test: Games-Howell
slowburn_summary_data %>%
ungroup() %>%
games_howell_test(., days_to_removed ~ Species_Treatment)
aov(days_to_removed ~ Treatment*Species*CBASS_temp, data = slowburn_summary_data)
summary(aov(days_to_removed ~ Treatment*Species*CBASS_temp, data = slowburn_summary_data))
capture.output(summary(aov(days_to_removed ~ Treatment*Species*CBASS_temp, data = slowburn_summary_data)), file = "daysuntilremoved_slowburn_anova_table.csv")
TukeyHSD(aov(days_to_removed ~ Treatment*Species*CBASS_temp, data = slowburn_summary_data))
capture.output(TukeyHSD(aov(days_to_removed ~ Treatment*Species*CBASS_temp, data = slowburn_summary_data)), file = "daysuntilremoved_slowburn_anova_tukey.csv")
slowburn_metadata %>%
filter(slowburn == "heatstress_32") %>%
filter(Removed_Date >= "2022-06-25" | is.na(Removed_Date)) %>%
mutate(Reason_removed = case_when(Reason_removed == "dead" ~ "RTL",
Reason_removed == "RTL" ~ "RTL",
Reason_removed == "paling" ~ "bleached",
Reason_removed == "bleaching" ~ "bleached")) %>%
group_by(Species,Treatment, Reason_removed) %>%
summarise(count = n()) %>%
ggplot(., aes(x=Treatment, y=count, fill = Reason_removed)) +
geom_bar(stat = "identity") +
facet_wrap(~Species)
slowburn_metadata %>%
filter(slowburn == "heatstress_32") %>%
filter(Removed_Date >= "2022-06-25" | is.na(Removed_Date)) %>%
mutate(Reason_removed = case_when(Reason_removed == "dead" ~ "RTL",
Reason_removed == "RTL" ~ "RTL",
Reason_removed == "paling" ~ "bleached",
Reason_removed == "bleaching" ~ "bleached")) %>%
group_by(Species,Treatment, Colony, Reason_removed) %>%
summarise(count = n()) %>%
ggplot(., aes(x=Colony, y=count, fill = Reason_removed)) +
geom_bar(stat = "identity") +
facet_wrap(~Species+Treatment, scales = "free_x")
slowburn_metadata %>%
filter(slowburn == "heatstress_32") %>%
filter(Removed_Date >= "2022-06-25" | is.na(Removed_Date)) %>%
mutate(Reason_removed = case_when(Reason_removed == "dead" ~ "RTL",
Reason_removed == "RTL" ~ "RTL",
Reason_removed == "paling" ~ "bleached",
Reason_removed == "bleaching" ~ "bleached")) %>%
drop_na(Reason_removed) %>%
group_by(Species,Treatment, Colony, Reason_removed) %>%
summarise(count = n()) %>%
ggplot(., aes(x=Colony, y=count, fill = Reason_removed)) +
geom_bar(stat = "identity") +
facet_wrap(~Species+Treatment, scales = "free_x")
slowburn_metadata %>%
filter(slowburn == "heatstress_32") %>%
filter(Removed_Date >= "2022-06-25" | is.na(Removed_Date)) %>%
mutate(Reason_removed = case_when(Reason_removed == "dead" ~ "RTL",
Reason_removed == "RTL" ~ "RTL",
Reason_removed == "paling" ~ "bleached",
Reason_removed == "bleaching" ~ "bleached")) %>%
drop_na(Reason_removed) %>%
group_by(Species,Treatment, Reason_removed) %>%
summarise(count = n()) %>%
ggplot(., aes(x=Treatment, y=count, fill = Reason_removed)) +
geom_bar(stat = "identity") +
facet_wrap(~Species)
slowburn_metadata %>%
filter(slowburn == "heatstress_32") %>%
filter(Removed_Date >= "2022-06-25" | is.na(Removed_Date)) %>%
mutate(Reason_removed = case_when(Reason_removed == "dead" ~ "RTL",
Reason_removed == "RTL" ~ "RTL",
Reason_removed == "paling" ~ "bleached",
Reason_removed == "bleaching" ~ "bleached")) %>%
drop_na(Reason_removed) %>%
group_by(Species,Treatment, Reason_removed) %>%
summarise(count = n()) %>%
ggplot(., aes(x=Treatment, y=count, fill = Reason_removed)) +
geom_bar(stat = "identity") +
facet_wrap(~Species)
ggsave("proportion_bleaching_RTL_species.pdf")
slowburn_metadata %>%
filter(slowburn == "heatstress_32") %>%
filter(Removed_Date >= "2022-06-25" | is.na(Removed_Date)) %>%
mutate(Reason_removed = case_when(Reason_removed == "dead" ~ "RTL",
Reason_removed == "RTL" ~ "RTL",
Reason_removed == "paling" ~ "bleached",
Reason_removed == "bleaching" ~ "bleached")) %>%
drop_na(Reason_removed) %>%
group_by(Species,Treatment, Colony, Reason_removed) %>%
summarise(count = n()) %>%
ggplot(., aes(x=Colony, y=count, fill = Reason_removed)) +
geom_bar(stat = "identity") +
facet_wrap(~Species+Treatment, scales = "free_x")
ggsave("proportion_bleaching_RTL_bycolony.pdf")
slowburn_metadata %>%
filter(slowburn == "heatstress_32") %>%
filter(Removed_Date >= "2022-06-25" | is.na(Removed_Date)) %>%
mutate(Reason_removed = case_when(Reason_removed == "dead" ~ "RTL",
Reason_removed == "RTL" ~ "RTL",
Reason_removed == "paling" ~ "bleached",
Reason_removed == "bleaching" ~ "bleached")) %>%
group_by(Species,Treatment, Reason_removed, CBASS_temp) %>%
summarise(count = n()) %>%
ggplot(., aes(x=CBASS_temp, y=count, fill = Reason_removed)) +
geom_bar(stat = "identity") +
facet_wrap(~Species+Treatment)
slowburn_metadata %>%
filter(slowburn == "heatstress_32") %>%
filter(Removed_Date >= "2022-06-25" | is.na(Removed_Date)) %>%
mutate(Reason_removed = case_when(Reason_removed == "dead" ~ "RTL",
Reason_removed == "RTL" ~ "RTL",
Reason_removed == "paling" ~ "bleached",
Reason_removed == "bleaching" ~ "bleached")) %>%
drop_na(Reason_removed) %>%
group_by(Species,Treatment, Reason_removed, CBASS_temp) %>%
summarise(count = n()) %>%
ggplot(., aes(x=CBASS_temp, y=count, fill = Reason_removed)) +
geom_bar(stat = "identity") +
facet_wrap(~Species+Treatment)
#chi squared test for comparing mortality numbers
slowburn_metadata %>%
filter(slowburn == "heatstress_32") %>%
filter(Removed_Date >= "2022-06-25" | is.na(Removed_Date)) %>%
mutate(Reason_removed = case_when(Reason_removed == "dead" ~ "RTL",
Reason_removed == "RTL" ~ "RTL",
Reason_removed == "paling" ~ "bleached",
Reason_removed == "bleaching" ~ "bleached")) %>%
drop_na(Reason_removed) %>%
group_by(Species,Treatment, Reason_removed) %>%
summarise(count = n()) %>%
drop_na() %>%
unite("Species.Treatment", Species,Treatment, sep = ".") %>%
pivot_wider(names_from="Reason_removed", values_from = "count") %>%
column_to_rownames(var="Species.Treatment") %>%
as.data.frame() %>%
chisq_test() # significant
slowburn_metadata %>%
filter(slowburn == "heatstress_32") %>%
filter(Removed_Date >= "2022-06-25" | is.na(Removed_Date)) %>%
mutate(Reason_removed = case_when(Reason_removed == "dead" ~ "RTL",
Reason_removed == "RTL" ~ "RTL",
Reason_removed == "paling" ~ "bleached",
Reason_removed == "bleaching" ~ "bleached")) %>%
group_by(Species,Treatment, Reason_removed) %>%
summarise(count = n()) %>%
unite("Species.Treatment", Species,Treatment, sep = ".") %>%
pivot_wider(names_from="Reason_removed", values_from = "count") %>%
column_to_rownames(var="Species.Treatment") %>%
as.data.frame() %>%
pairwise_prop_test() %>%
write_csv("pairwise_prop_test_RTLvsbleaching_slowburn.csv")
slowburn_metadata %>%
filter(slowburn == "heatstress_32") %>%
filter(Removed_Date >= "2022-06-25" | is.na(Removed_Date)) %>%
mutate(Reason_removed = case_when(Reason_removed == "dead" ~ "RTL",
Reason_removed == "RTL" ~ "RTL",
Reason_removed == "paling" ~ "bleached",
Reason_removed == "bleaching" ~ "bleached")) %>%
group_by(Species,Treatment, Reason_removed) %>%
summarise(count = n()) %>%
unite("Species.Treatment", Species,Treatment, sep = ".") %>%
pivot_wider(names_from="Reason_removed", values_from = "count") %>%
column_to_rownames(var="Species.Treatment") %>%
as.data.frame() %>%
pairwise_prop_test()
slowburn_metadata %>%
filter(slowburn == "heatstress_32") %>%
filter(Removed_Date >= "2022-06-25" | is.na(Removed_Date)) %>%
mutate(Reason_removed = case_when(Reason_removed == "dead" ~ "RTL",
Reason_removed == "RTL" ~ "RTL",
Reason_removed == "paling" ~ "bleached",
Reason_removed == "bleaching" ~ "bleached")) %>%
group_by(Species,Treatment, Reason_removed) %>%
summarise(count = n()) %>%
unite("Species.Treatment", Species,Treatment, sep = ".") %>%
pivot_wider(names_from="Reason_removed", values_from = "count") %>%
column_to_rownames(var="Species.Treatment")
slowburn_metadata %>%
filter(slowburn == "heatstress_32") %>%
filter(Removed_Date >= "2022-06-25" | is.na(Removed_Date)) %>%
mutate(Reason_removed = case_when(Reason_removed == "dead" ~ "RTL",
Reason_removed == "RTL" ~ "RTL",
Reason_removed == "paling" ~ "bleached",
Reason_removed == "bleaching" ~ "bleached")) %>%
drop_na(Reason_removed) %>%
group_by(Species,Treatment, Reason_removed) %>%
summarise(count = n()) %>%
unite("Species.Treatment", Species,Treatment, sep = ".") %>%
pivot_wider(names_from="Reason_removed", values_from = "count") %>%
column_to_rownames(var="Species.Treatment") %>%
as.data.frame() %>%
pairwise_prop_test() %>%
write_csv("pairwise_prop_test_RTLvsbleaching_slowburn.csv")
slowburn_metadata %>%
filter(slowburn == "heatstress_32") %>%
filter(Removed_Date >= "2022-06-25" | is.na(Removed_Date)) %>%
mutate(Reason_removed = case_when(Reason_removed == "dead" ~ "RTL",
Reason_removed == "RTL" ~ "RTL",
Reason_removed == "paling" ~ "bleached",
Reason_removed == "bleaching" ~ "bleached")) %>%
drop_na(Reason_removed) %>%
group_by(Species,Treatment, Reason_removed) %>%
summarise(count = n()) %>%
unite("Species.Treatment", Species,Treatment, sep = ".") %>%
pivot_wider(names_from="Reason_removed", values_from = "count") %>%
column_to_rownames(var="Species.Treatment") %>%
as.data.frame() %>%
pairwise_prop_test()
#chi squared test for comparing mortality numbers
slowburn_metadata %>%
filter(slowburn == "heatstress_32") %>%
filter(Removed_Date >= "2022-06-25" | is.na(Removed_Date)) %>%
mutate(Reason_removed = case_when(Reason_removed == "dead" ~ "RTL",
Reason_removed == "RTL" ~ "RTL",
Reason_removed == "paling" ~ "bleached",
Reason_removed == "bleaching" ~ "bleached")) %>%
group_by(Species, Colony,Treatment, Reason_removed) %>%
summarise(count = n()) %>%
drop_na() %>%
unite("Species.Colony.Treatment", Species,Colony,Treatment, sep = ".") %>%
pivot_wider(names_from="Reason_removed", values_from = "count") %>%
mutate(bleached = if_else(is.na(bleached),0,bleached)) %>%
mutate(RTL = if_else(is.na(RTL),0,RTL)) %>%
column_to_rownames(var="Species.Colony.Treatment") %>%
as.data.frame() %>%
chisq_test() # significant
slowburn_metadata %>%
filter(slowburn == "heatstress_32") %>%
filter(Removed_Date >= "2022-06-25" | is.na(Removed_Date)) %>%
mutate(Reason_removed = case_when(Reason_removed == "dead" ~ "RTL",
Reason_removed == "RTL" ~ "RTL",
Reason_removed == "paling" ~ "bleached",
Reason_removed == "bleaching" ~ "bleached")) %>%
drop_na() %>%
group_by(Species, Colony,Treatment, Reason_removed) %>%
summarise(count = n()) %>%
unite("Species.Colony.Treatment", Species,Colony,Treatment, sep = ".") %>%
pivot_wider(names_from="Reason_removed", values_from = "count") %>%
mutate(bleached = if_else(is.na(bleached),0,bleached)) %>%
mutate(RTL = if_else(is.na(RTL),0,RTL)) %>%
column_to_rownames(var="Species.Colony.Treatment") %>%
as.data.frame() %>%
pairwise_prop_test() %>%
write_csv("pairwise_prop_test_RTLvsbleaching_slowburn.csv")
slowburn_metadata %>%
filter(slowburn == "heatstress_32") %>%
filter(Removed_Date >= "2022-06-25" | is.na(Removed_Date)) %>%
mutate(Reason_removed = case_when(Reason_removed == "dead" ~ "RTL",
Reason_removed == "RTL" ~ "RTL",
Reason_removed == "paling" ~ "bleached",
Reason_removed == "bleaching" ~ "bleached")) %>%
drop_na() %>%
group_by(Species, Colony,Treatment, Reason_removed) %>%
summarise(count = n()) %>%
unite("Species.Colony.Treatment", Species,Colony,Treatment, sep = ".") %>%
pivot_wider(names_from="Reason_removed", values_from = "count") %>%
mutate(bleached = if_else(is.na(bleached),0,bleached)) %>%
mutate(RTL = if_else(is.na(RTL),0,RTL)) %>%
column_to_rownames(var="Species.Colony.Treatment") %>%
as.data.frame() %>%
pairwise_prop_test()
slowburn_metadata %>%
filter(slowburn == "heatstress_32") %>%
filter(Removed_Date >= "2022-06-25" | is.na(Removed_Date)) %>%
mutate(Reason_removed = case_when(Reason_removed == "dead" ~ "RTL",
Reason_removed == "RTL" ~ "RTL",
Reason_removed == "paling" ~ "bleached",
Reason_removed == "bleaching" ~ "bleached")) %>%
drop_na(Reason_removed) %>%
group_by(Species, Colony,Treatment, Reason_removed) %>%
summarise(count = n()) %>%
unite("Species.Colony.Treatment", Species,Colony,Treatment, sep = ".") %>%
pivot_wider(names_from="Reason_removed", values_from = "count") %>%
mutate(bleached = if_else(is.na(bleached),0,bleached)) %>%
mutate(RTL = if_else(is.na(RTL),0,RTL)) %>%
column_to_rownames(var="Species.Colony.Treatment") %>%
as.data.frame() %>%
pairwise_prop_test() %>%
write_csv("pairwise_prop_test_RTLvsbleaching_slowburn.csv")
slowburn_metadata %>%
filter(slowburn == "heatstress_32") %>%
filter(Removed_Date >= "2022-06-25" | is.na(Removed_Date)) %>%
mutate(Reason_removed = case_when(Reason_removed == "dead" ~ "RTL",
Reason_removed == "RTL" ~ "RTL",
Reason_removed == "paling" ~ "bleached",
Reason_removed == "bleaching" ~ "bleached")) %>%
drop_na(Reason_removed) %>%
group_by(Species, Colony,Treatment, Reason_removed) %>%
summarise(count = n()) %>%
unite("Species.Colony.Treatment", Species,Colony,Treatment, sep = ".") %>%
pivot_wider(names_from="Reason_removed", values_from = "count") %>%
mutate(bleached = if_else(is.na(bleached),0,bleached)) %>%
mutate(RTL = if_else(is.na(RTL),0,RTL)) %>%
column_to_rownames(var="Species.Colony.Treatment") %>%
as.data.frame() %>%
pairwise_prop_test()
library(tidyverse)
library(janitor)
library(rstatix)
library(cowplot)
library(plotrix)
metadata <- readxl::read_xlsx("../metadata.xlsx", sheet = "tidy_data")
str(metadata) #295 corals
metadata %>%
mutate(CBASS_temp = case_when(CBASS_tank == "1" ~ "36",
CBASS_tank == "2" ~ "37",
CBASS_tank == "3" ~ "32",
CBASS_tank == "4" ~ "33",
CBASS_tank == "5" ~ "35",
CBASS_tank == "6" ~ "30",
CBASS_tank == "7" ~ "34",
CBASS_tank == "8" ~ "28")) -> tidy_metadata
tidy_metadata %>%
filter(Removed_Date < "2022-05-20") %>%
arrange(desc(Removed_Date))
#April 26 was the last coral reported with a mortality date until the slow burn heat stress started. So have April 26 be the cut-off point for CBASS mortality plots.
ggplot(tidy_metadata, aes(x=Removed_Date, fill = Treatment)) +
geom_bar() +
facet_wrap(~Species)
ggplot(tidy_metadata, aes(x=mortality_date, fill = Treatment)) +
geom_bar() +
facet_wrap(~Species)
CBASS_mortality <- tidy_metadata %>%
dplyr::filter(Removed_Date >= "2022-04-20" & Removed_Date <= "2022-04-26")
#for this time period, Removed_Date and mortality_date match up so there's no need to use the coalesce function
#99 corals died during CBASS
metadata %>%
filter(!is.na(slowburn_heatstress_tank)) #163 corals
metadata %>%
filter(!is.na(slowburn_heatstress_tank)) %>%
select(Species:heatstress_recovery_tank) %>%
mutate(CBASS_temp = case_when(CBASS_tank == "1" ~ "36",
CBASS_tank == "2" ~ "37",
CBASS_tank == "3" ~ "32",
CBASS_tank == "4" ~ "33",
CBASS_tank == "5" ~ "35",
CBASS_tank == "6" ~ "30",
CBASS_tank == "7" ~ "34",
CBASS_tank == "8" ~ "28")) %>%
mutate(slowburn= case_when(slowburn_heatstress_tank == "7" ~ "ambient",
TRUE ~ "heatstress_32")) -> slowburn_metadata
slowburn_metadata %>%
filter(slowburn == "heatstress_32") %>%
filter(Removed_Date >= "2022-06-25" | is.na(Removed_Date)) %>%
mutate(Reason_removed = case_when(Reason_removed == "dead" ~ "RTL",
Reason_removed == "RTL" ~ "RTL",
Reason_removed == "paling" ~ "bleached",
Reason_removed == "bleaching" ~ "bleached"))  %>%
ggplot(., aes(x=Reason_removed, y=count, fill = Treatment)) +
geom_col(position = position_dodge()) +
theme_classic() +
facet_wrap(~Species)  +
scale_fill_manual(labels=c("Treated", "Untreated"), values = c("#F54A34", "#60DBDB"))  +
theme(text = element_text(size = 15)) +
labs(x="Category", y="Number of corals")
slowburn_metadata %>%
filter(slowburn == "heatstress_32") %>%
filter(Removed_Date >= "2022-06-25" | is.na(Removed_Date)) %>%
mutate(Reason_removed = case_when(Reason_removed == "dead" ~ "RTL",
Reason_removed == "RTL" ~ "RTL",
Reason_removed == "paling" ~ "bleached",
Reason_removed == "bleaching" ~ "bleached"))
slowburn_metadata %>%
filter(slowburn == "heatstress_32") %>%
filter(Removed_Date >= "2022-06-25" | is.na(Removed_Date)) %>%
mutate(Reason_removed = case_when(Reason_removed == "dead" ~ "RTL",
Reason_removed == "RTL" ~ "RTL",
Reason_removed == "paling" ~ "bleached",
Reason_removed == "bleaching" ~ "bleached")) %>%
drop_na(Reason_removed) %>%
group_by(Species,Treatment, Reason_removed) %>%
summarise(count = n())
#chi squared test for comparing mortality numbers
slowburn_metadata %>%
filter(slowburn == "heatstress_32") %>%
filter(Removed_Date >= "2022-06-25" | is.na(Removed_Date)) %>%
mutate(Reason_removed = case_when(Reason_removed == "dead" ~ "RTL",
Reason_removed == "RTL" ~ "RTL",
Reason_removed == "paling" ~ "bleached",
Reason_removed == "bleaching" ~ "bleached")) %>%
drop_na(Reason_removed) %>%
group_by(Species,Treatment, Reason_removed) %>%
summarise(count = n()) %>%
drop_na() %>%
unite("Species.Treatment", Species,Treatment, sep = ".") %>%
pivot_wider(names_from="Reason_removed", values_from = "count") %>%
column_to_rownames(var="Species.Treatment") %>%
as.data.frame() %>%
chisq_test() # significant
