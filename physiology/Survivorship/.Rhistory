ggplot(., aes(x=Percent_Survival_Day5, y = mean_expression, color= Treatment)) +
geom_point() +
geom_smooth(method = "lm", se = FALSE, aes(group = Treatment)) + # Add linear model lines without confidence interval
theme_classic() +
scale_color_manual(values = c( "#FF3333", "#00CCCC"))+
labs(y = "Mean Expression Level") +
theme(text = element_text(size = 15)) +
facet_wrap(~Treatment, scales="free_x")
Acer_slowburn_survival %>%
right_join(., normalized_counts_Acropora_017542) %>%
group_by(Treatment,Genotype) %>%
ggplot(., aes(x=Percent_Survival_Day5, y = value, color= Treatment)) +
geom_point() +
geom_smooth(method = "lm", se = FALSE, aes(group = Treatment)) + # Add linear model lines without confidence interval
theme_classic() +
scale_color_manual(values = c( "#FF3333", "#00CCCC"))+
labs(y = "Normalized Expression Level") +
theme(text = element_text(size = 15))+
facet_wrap(~Treatment, scales="free_x")
Acer_slowburn_survival %>%
right_join(., normalized_counts_Acropora_017542) %>%
group_by(Treatment,Genotype) %>%
ggplot(., aes(x=Percent_Survival_Day5, y = value, color= Treatment)) +
geom_point() +
geom_smooth(method = "lm", se = FALSE, aes(group = Treatment)) + # Add linear model lines without confidence interval
theme_classic() +
scale_color_manual(values = c( "#FF3333", "#00CCCC"))+
labs(title = "Acropora_017542 = Belongs to the small heat shock protein (HSP20) family", x = "% Survival by Day 5", y = "Normalized Expression Level") +
theme(text = element_text(size = 15))+
facet_wrap(~Treatment, scales="free_x")
Acer_slowburn_survival %>%
right_join(., normalized_counts_Acropora_017542) %>%
group_by(Treatment,Genotype) %>%
ggplot(., aes(x=Percent_Survival_Day5, y = value, color= Treatment)) +
geom_point() +
geom_smooth(method = "lm", se = FALSE, aes(group = Treatment)) + # Add linear model lines without confidence interval
theme_classic() +
scale_color_manual(values = c( "#FF3333", "#00CCCC"))+
labs(title = "Acropora_017542 = Belongs to the small heat shock protein (HSP20) family", x = "% Survival by Day 5", y = "Normalized Expression Level") +
facet_wrap(~Treatment, scales="free_x")
Acer_slowburn_survival %>%
right_join(., normalized_counts_Acropora_017542) %>%
group_by(Treatment,Genotype) %>%
ggplot(., aes(x=Percent_Survival_Day5, y = value, color= Treatment)) +
geom_point() +
geom_smooth(method = "lm", se = FALSE, aes(group = Treatment)) + # Add linear model lines without confidence interval
theme_classic() +
scale_color_manual(values = c( "#FF3333", "#00CCCC"))+
labs(title = "Acropora_017542 = Belongs to the small heat shock protein (HSP20) family", x = "% Survival at 32ºC by Day 5", y = "Normalized Expression Level") +
facet_wrap(~Treatment, scales="free_x")
Acer_slowburn_survival %>%
right_join(., normalized_counts_Acropora_015765) %>%
group_by(Treatment,Genotype) %>%
ggplot(., aes(x=Percent_Survival_Day5, y = value, color= Treatment)) +
geom_point() +
geom_smooth(method = "lm", se = FALSE, aes(group = Treatment)) + # Add linear model lines without confidence interval
theme_classic() +
scale_color_manual(values = c( "#FF3333", "#00CCCC"))+
labs(title = "Acropora_015765 = transmembrane receptor protein tyrosine kinase activity", x = "% Survival at 32ºC by Day 5", y = "Normalized Expression Level") +
theme(text = element_text(size = 15))+
facet_wrap(~Treatment, scales="free_x")
Acer_slowburn_survival %>%
right_join(., normalized_counts_Acropora_015765) %>%
group_by(Treatment,Genotype) %>%
ggplot(., aes(x=Percent_Survival_Day5, y = value, color= Treatment)) +
geom_point() +
geom_smooth(method = "lm", se = FALSE, aes(group = Treatment)) + # Add linear model lines without confidence interval
theme_classic() +
scale_color_manual(values = c( "#FF3333", "#00CCCC"))+
labs(title = "Acropora_015765 = transmembrane receptor protein tyrosine kinase activity", x = "% Survival at 32ºC by Day 5", y = "Normalized Expression Level") +
facet_wrap(~Treatment, scales="free_x")
Acer_slowburn_survival %>%
right_join(., normalized_counts_Acropora_000238) %>%
group_by(Treatment,Genotype) %>%
ggplot(., aes(x=Percent_Survival_Day5, y = value, color= Treatment)) +
geom_point() +
geom_smooth(method = "lm", se = FALSE, aes(group = Treatment)) + # Add linear model lines without confidence interval
theme_classic() +
scale_color_manual(values = c( "#FF3333", "#00CCCC"))+
labs(title = "Acropora_000238 = nucleosome", x = "% Survival at 32ºC by Day 5", y = "Normalized Expression Level") +
facet_wrap(~Treatment, scales="free_x")
Acer_slowburn_survival %>%
right_join(., normalized_counts_Acropora_010783) %>%
group_by(Treatment,Genotype) %>%
ggplot(., aes(x=Percent_Survival_Day5, y = value, color= Treatment)) +
geom_point() +
geom_smooth(method = "lm", se = FALSE, aes(group = Treatment)) + # Add linear model lines without confidence interval
theme_classic() +
scale_color_manual(values = c( "#FF3333", "#00CCCC"))+
labs(title = "Acropora_010783 = green fluorescent protein", x = "% Survival at 32ºC by Day 5", y = "Normalized Expression Level") +
facet_wrap(~Treatment, scales="free_x")
Acer_slowburn_survival %>%
right_join(., normalized_counts_Acropora_019471) %>%
group_by(Treatment,Genotype) %>%
ggplot(., aes(x=Percent_Survival_Day5, y = value, color= Treatment)) +
geom_point() +
geom_smooth(method = "lm", se = FALSE, aes(group = Treatment)) + # Add linear model lines without confidence interval
theme_classic() +
scale_color_manual(values = c( "#FF3333", "#00CCCC"))+
labs(title = "Acropora_019471 = nitric-oxide synthase activity", x = "% Survival at 32ºC by Day 5", y = "Normalized Expression Level") +
facet_wrap(~Treatment, scales="free_x")
Acer_slowburn_survival %>%
right_join(., normalized_counts_Acropora_023112) %>%
group_by(Treatment,Genotype) %>%
ggplot(., aes(x=Percent_Survival_Day5, y = value, color= Treatment)) +
geom_point() +
geom_smooth(method = "lm", se = FALSE, aes(group = Treatment)) + # Add linear model lines without confidence interval
theme_classic() +
scale_color_manual(values = c( "#FF3333", "#00CCCC"))+
labs(title = "Acropora_023112 = histone H2A", x = "% Survival at 32ºC by Day 5", y = "Normalized Expression Level") +
facet_wrap(~Treatment, scales="free_x")
p1<-Acer_slowburn_survival %>%
right_join(., normalized_counts_Acropora_023112) %>%
group_by(Treatment,Genotype) %>%
ggplot(., aes(x=Percent_Survival_Day5, y = value, color= Treatment)) +
geom_point() +
geom_smooth(method = "lm", se = FALSE, aes(group = Treatment)) + # Add linear model lines without confidence interval
theme_classic() +
scale_color_manual(values = c( "#FF3333", "#00CCCC"))+
labs(title = "Acropora_023112 = histone H2A", x = "% Survival at 32ºC by Day 5", y = "Normalized Expression Level") +
facet_wrap(~Treatment, scales="free_x")
library(cowplot)
p2<-Acer_slowburn_survival %>%
right_join(., normalized_counts_Acropora_019471) %>%
group_by(Treatment,Genotype) %>%
ggplot(., aes(x=Percent_Survival_Day5, y = value, color= Treatment)) +
geom_point() +
geom_smooth(method = "lm", se = FALSE, aes(group = Treatment)) + # Add linear model lines without confidence interval
theme_classic() +
scale_color_manual(values = c( "#FF3333", "#00CCCC"))+
labs(title = "Acropora_019471 = nitric-oxide synthase activity", x = "% Survival at 32ºC by Day 5", y = "Normalized Expression Level") +
facet_wrap(~Treatment, scales="free_x")
p3<-Acer_slowburn_survival %>%
right_join(., normalized_counts_Acropora_010783) %>%
group_by(Treatment,Genotype) %>%
ggplot(., aes(x=Percent_Survival_Day5, y = value, color= Treatment)) +
geom_point() +
geom_smooth(method = "lm", se = FALSE, aes(group = Treatment)) + # Add linear model lines without confidence interval
theme_classic() +
scale_color_manual(values = c( "#FF3333", "#00CCCC"))+
labs(title = "Acropora_010783 = green fluorescent protein", x = "% Survival at 32ºC by Day 5", y = "Normalized Expression Level") +
facet_wrap(~Treatment, scales="free_x")
p4<-Acer_slowburn_survival %>%
right_join(., normalized_counts_Acropora_000238) %>%
group_by(Treatment,Genotype) %>%
ggplot(., aes(x=Percent_Survival_Day5, y = value, color= Treatment)) +
geom_point() +
geom_smooth(method = "lm", se = FALSE, aes(group = Treatment)) + # Add linear model lines without confidence interval
theme_classic() +
scale_color_manual(values = c( "#FF3333", "#00CCCC"))+
labs(title = "Acropora_000238 = nucleosome", x = "% Survival at 32ºC by Day 5", y = "Normalized Expression Level") +
facet_wrap(~Treatment, scales="free_x")
p5<-Acer_slowburn_survival %>%
right_join(., normalized_counts_Acropora_015765) %>%
group_by(Treatment,Genotype) %>%
ggplot(., aes(x=Percent_Survival_Day5, y = value, color= Treatment)) +
geom_point() +
geom_smooth(method = "lm", se = FALSE, aes(group = Treatment)) + # Add linear model lines without confidence interval
theme_classic() +
scale_color_manual(values = c( "#FF3333", "#00CCCC"))+
labs(title = "Acropora_015765 = transmembrane receptor protein tyrosine kinase activity", x = "% Survival at 32ºC by Day 5", y = "Normalized Expression Level") +
facet_wrap(~Treatment, scales="free_x")
p6<-Acer_slowburn_survival %>%
right_join(., normalized_counts_Acropora_017542) %>%
group_by(Treatment,Genotype) %>%
ggplot(., aes(x=Percent_Survival_Day5, y = value, color= Treatment)) +
geom_point() +
geom_smooth(method = "lm", se = FALSE, aes(group = Treatment)) + # Add linear model lines without confidence interval
theme_classic() +
scale_color_manual(values = c( "#FF3333", "#00CCCC"))+
labs(title = "Acropora_017542 = Belongs to the small heat shock protein (HSP20) family", x = "% Survival at 32ºC by Day 5", y = "Normalized Expression Level") +
facet_wrap(~Treatment, scales="free_x")
plot_grid(p1, p2, p3, p4, p5, p6, ncol = 3)
Acer_slowburn_survival %>%
right_join(., normalized_counts_Acropora_017542) %>%
group_by(Treatment,Genotype) %>%
mutate(mean_expression = mean(value)) %>%
ggplot(., aes(x=Percent_Survival_Day5, y = mean_expression, color= Treatment)) +
geom_point() +
geom_smooth(method = "lm", se = FALSE, aes(group = Treatment)) + # Add linear model lines without confidence interval
theme_classic() +
scale_color_manual(values = c( "#FF3333", "#00CCCC"))+
labs(y = "Mean Expression Level") +
theme(text = element_text(size = 15)) +
facet_wrap(~Treatment, scales="free_x")
p6<-Acer_slowburn_survival %>%
right_join(., normalized_counts_Acropora_017542) %>%
group_by(Treatment,Genotype) %>%
ggplot(., aes(x=Percent_Survival_Day5, y = value, color= Treatment)) +
geom_point() +
geom_smooth(method = "lm", se = FALSE, aes(group = Treatment)) + # Add linear model lines without confidence interval
theme_classic() +
scale_color_manual(values = c( "#FF3333", "#00CCCC"))+
labs(title = "Acropora_017542 = Belongs to the small heat shock protein (HSP20) family", x = "% Survival at 32ºC by Day 5", y = "Normalized Expression Level") +
facet_wrap(~Treatment, scales="free_x") +
theme(legend.position = "none")
p5<-Acer_slowburn_survival %>%
right_join(., normalized_counts_Acropora_015765) %>%
group_by(Treatment,Genotype) %>%
ggplot(., aes(x=Percent_Survival_Day5, y = value, color= Treatment)) +
geom_point() +
geom_smooth(method = "lm", se = FALSE, aes(group = Treatment)) + # Add linear model lines without confidence interval
theme_classic() +
scale_color_manual(values = c( "#FF3333", "#00CCCC"))+
labs(title = "Acropora_015765 = transmembrane receptor protein tyrosine kinase activity", x = "% Survival at 32ºC by Day 5", y = "Normalized Expression Level") +
facet_wrap(~Treatment, scales="free_x")+
theme(legend.position = "none")
p4<-Acer_slowburn_survival %>%
right_join(., normalized_counts_Acropora_000238) %>%
group_by(Treatment,Genotype) %>%
ggplot(., aes(x=Percent_Survival_Day5, y = value, color= Treatment)) +
geom_point() +
geom_smooth(method = "lm", se = FALSE, aes(group = Treatment)) + # Add linear model lines without confidence interval
theme_classic() +
scale_color_manual(values = c( "#FF3333", "#00CCCC"))+
labs(title = "Acropora_000238 = nucleosome", x = "% Survival at 32ºC by Day 5", y = "Normalized Expression Level") +
facet_wrap(~Treatment, scales="free_x")+
theme(legend.position = "none")
p3<-Acer_slowburn_survival %>%
right_join(., normalized_counts_Acropora_010783) %>%
group_by(Treatment,Genotype) %>%
ggplot(., aes(x=Percent_Survival_Day5, y = value, color= Treatment)) +
geom_point() +
geom_smooth(method = "lm", se = FALSE, aes(group = Treatment)) + # Add linear model lines without confidence interval
theme_classic() +
scale_color_manual(values = c( "#FF3333", "#00CCCC"))+
labs(title = "Acropora_010783 = green fluorescent protein", x = "% Survival at 32ºC by Day 5", y = "Normalized Expression Level") +
facet_wrap(~Treatment, scales="free_x")+
theme(legend.position = "none")
p2<-Acer_slowburn_survival %>%
right_join(., normalized_counts_Acropora_019471) %>%
group_by(Treatment,Genotype) %>%
ggplot(., aes(x=Percent_Survival_Day5, y = value, color= Treatment)) +
geom_point() +
geom_smooth(method = "lm", se = FALSE, aes(group = Treatment)) + # Add linear model lines without confidence interval
theme_classic() +
scale_color_manual(values = c( "#FF3333", "#00CCCC"))+
labs(title = "Acropora_019471 = nitric-oxide synthase activity", x = "% Survival at 32ºC by Day 5", y = "Normalized Expression Level") +
facet_wrap(~Treatment, scales="free_x")+
theme(legend.position = "none")
p1<-Acer_slowburn_survival %>%
right_join(., normalized_counts_Acropora_023112) %>%
group_by(Treatment,Genotype) %>%
ggplot(., aes(x=Percent_Survival_Day5, y = value, color= Treatment)) +
geom_point() +
geom_smooth(method = "lm", se = FALSE, aes(group = Treatment)) + # Add linear model lines without confidence interval
theme_classic() +
scale_color_manual(values = c( "#FF3333", "#00CCCC"))+
labs(title = "Acropora_023112 = histone H2A", x = "% Survival at 32ºC by Day 5", y = "Normalized Expression Level") +
facet_wrap(~Treatment, scales="free_x")+
theme(legend.position = "none")
plot_grid(p1, p2, p3, p4, p5, p6, ncol = 3)
ggsave("specificgenes_correlationsurvivorship.pdf", width = 10, height = 6)
Acer_slowburn_survival %>%
right_join(., normalized_counts_Acropora_023112) %>%
group_by(Treatment) %>%
do(tidy(lm(Percent_Survival_Day5 ~ value, data = .))) # for p-values (neither correlation is significant)
Acer_slowburn_survival %>%
right_join(., normalized_counts_Acropora_023112) %>%
group_by(Treatment) %>%
summarize(correlation = cor(Percent_Survival_Day5, value))
Acer_slowburn_survival %>%
right_join(., normalized_counts_Acropora_019471) %>%
group_by(Treatment) %>%
do(tidy(lm(Percent_Survival_Day5 ~ value, data = .))) # for p-values (neither correlation is significant)
Acer_slowburn_survival %>%
right_join(., normalized_counts_Acropora_019471) %>%
group_by(Treatment) %>%
summarize(correlation = cor(Percent_Survival_Day5, value))
Acer_slowburn_survival %>%
right_join(., normalized_counts_Acropora_010783) %>%
group_by(Treatment) %>%
do(tidy(lm(Percent_Survival_Day5 ~ value, data = .))) # for p-values (neither correlation is significant)
Acer_slowburn_survival %>%
right_join(., normalized_counts_Acropora_010783) %>%
group_by(Treatment) %>%
summarize(correlation = cor(Percent_Survival_Day5, value))
Acer_slowburn_survival %>%
right_join(., normalized_counts_Acropora_000238) %>%
group_by(Treatment) %>%
do(tidy(lm(Percent_Survival_Day5 ~ value, data = .))) # for p-values (neither correlation is significant)
Acer_slowburn_survival %>%
right_join(., normalized_counts_Acropora_000238) %>%
group_by(Treatment) %>%
summarize(correlation = cor(Percent_Survival_Day5, value))
Acer_slowburn_survival %>%
right_join(., normalized_counts_Acropora_015765) %>%
group_by(Treatment) %>%
do(tidy(lm(Percent_Survival_Day5 ~ value, data = .))) # for p-values (neither correlation is significant)
Acer_slowburn_survival %>%
right_join(., normalized_counts_Acropora_015765) %>%
group_by(Treatment) %>%
summarize(correlation = cor(Percent_Survival_Day5, value)) #
Acer_slowburn_survival %>%
right_join(., normalized_counts_Acropora_017542) %>%
group_by(Treatment) %>%
do(tidy(lm(Percent_Survival_Day5 ~ value, data = .))) # for p-values (neither correlation is significant)
Acer_slowburn_survival %>%
right_join(., normalized_counts_Acropora_017542) %>%
group_by(Treatment) %>%
summarize(correlation = cor(Percent_Survival_Day5, value))
library(tidyverse)
library(janitor)
library(rstatix)
library(cowplot)
library(plotrix)
library(survival)
library(ggpubr)
library(survminer)
library(coxme)
library(ggsurvfit)
library(gtsummary)
metadata <- readxl::read_xlsx("../metadata.xlsx", sheet = "tidy_data")
str(metadata) #295 corals
survivorship <- readxl::read_xlsx("../metadata.xlsx", sheet ="kaplanmeiercurve")
View(survivorship)
library(tidyverse)
library(janitor)
library(rstatix)
library(cowplot)
library(plotrix)
library(survival)
library(ggpubr)
library(survminer)
library(coxme)
library(ggsurvfit)
library(gtsummary)
metadata <- readxl::read_xlsx("../metadata.xlsx", sheet = "tidy_data")
str(metadata) #295 corals
survivorship <- readxl::read_xlsx("../metadata.xlsx", sheet ="kaplanmeiercurve")
metadata %>%
mutate(CBASS_temp = case_when(CBASS_tank == "1" ~ "36",
CBASS_tank == "2" ~ "37",
CBASS_tank == "3" ~ "32",
CBASS_tank == "4" ~ "33",
CBASS_tank == "5" ~ "35",
CBASS_tank == "6" ~ "30",
CBASS_tank == "7" ~ "34",
CBASS_tank == "8" ~ "28")) -> tidy_metadata
metadata %>%
filter(is.na(Removed_Date) & is.na(mortality_date)) #41 corals don't have either. But if they weren't assigned a heat-stress tank, that should indicate that they were removed/died before 06/15/2022
metadata %>%
filter(is.na(Removed_Date) & is.na(mortality_date) & is.na(slowburn_heatstress_tank)) # 5 corals. looks like the four Acer were tissue sampled and the Pcli who knows, it got buoyant weighed on April 21. they probably died sometime after CBASS and before heat stress.
tidy_metadata %>%
filter(Removed_Date < "2022-05-20") %>%
arrange(desc(Removed_Date))
#April 26 was the last coral reported with a mortality date until the slow burn heat stress started. So have April 26 be the cut-off point for CBASS mortality plots.
ggplot(tidy_metadata, aes(x=Removed_Date, fill = Treatment)) +
geom_bar() +
facet_wrap(~Species)
ggplot(tidy_metadata, aes(x=mortality_date, fill = Treatment)) +
geom_bar() +
facet_wrap(~Species)
CBASS_mortality <- tidy_metadata %>%
dplyr::filter(Removed_Date >= "2022-04-20" & Removed_Date <= "2022-04-26")
#for this time period, Removed_Date and mortality_date match up so there's no need to use the coalesce function
#99 corals died during CBASS
tidy_metadata %>%
dplyr::filter(Removed_Date >= "2022-04-20" & Removed_Date <= "2022-04-26") %>%
drop_na(Species, Treatment, Reason_removed) %>%
group_by(Reason_removed, Species, Treatment) %>%
dplyr::summarize(count = n()) %>%
ggplot(., aes(x=Reason_removed, y=count, fill = Treatment)) +
geom_col(position = position_dodge()) +
theme_classic() +
facet_wrap(~Species)  +
scale_fill_manual(labels=c("Treated", "Untreated"), values = c("#F54A34", "#60DBDB"))  +
theme(text = element_text(size = 15)) +
labs(x="Category", y="Number of corals") +
coord_flip()
CBASS_mortality %>%
mutate(Reason_removed = case_when(Reason_removed == "dead" ~ "RTL",
Reason_removed == "post-CBASS RTL" ~ "RTL",
Reason_removed == "RTL" ~ "RTL")) %>%
drop_na(Species, Treatment) %>%
group_by(Species, Treatment) %>%
dplyr::summarize(count_RTL = n()) -> RTL_species_treatment_count
CBASS_mortality %>%
mutate(Reason_removed = case_when(Reason_removed == "dead" ~ "RTL",
Reason_removed == "post-CBASS RTL" ~ "RTL",
Reason_removed == "RTL" ~ "RTL")) %>%
drop_na(Species, Treatment) %>%
group_by(Species, Treatment, CBASS_temp) %>%
dplyr::summarize(count_RTL = n()) -> RTL_species_treatment_CBASStemps
RTL_species_treatment_CBASStemps
tidy_metadata %>%
dplyr::filter(!Removed_Date <= "2022-04-20" | is.na(Removed_Date)) %>% #remove everything that was removed before CBASS so you only account for RTL due to CBASS
group_by(Species, Treatment) %>%
dplyr::summarize(count_total = n()) %>%
full_join(., RTL_species_treatment_count) %>%
mutate(count_survived = count_total-count_RTL) %>%
dplyr::select(!count_total) %>%
pivot_longer(count_RTL:count_survived, names_to="label", values_to="count") %>%
ggplot(., aes(x=Treatment, y=count, fill = label)) +
geom_col() +
theme_classic() +
scale_fill_manual(labels=c("RTL", "Survived"), values = c("black", "grey"))  +
theme(text = element_text(size = 12)) +
facet_wrap(~Species, scales = "free_x") +
labs(y="Count", fill = "Category")
tidy_metadata %>%
dplyr::filter(!Removed_Date <= "2022-04-20" | is.na(Removed_Date)) %>% #remove everything that was removed before CBASS so you only account for RTL due to CBASS
group_by(Species, Treatment, CBASS_temp) %>%
dplyr::summarize(count_total = n()) %>%
full_join(., RTL_species_treatment_CBASStemps) %>%
drop_na(CBASS_temp) %>%
mutate(count_RTL = if_else(is.na(count_RTL),0,count_RTL)) %>%
mutate(count_survived = count_total-count_RTL) %>%
mutate(count_survived = if_else(is.na(count_survived),0,count_survived)) %>%
dplyr::select(!count_total) %>%
pivot_longer(count_RTL:count_survived, names_to="label", values_to="count") %>%
ggplot(., aes(x=CBASS_temp, y=count, fill = label)) +
geom_col() +
theme_classic() +
scale_fill_manual(labels=c("RTL", "Survived"), values = c("black", "grey"))  +
theme(text = element_text(size = 12)) +
facet_wrap(~Species*Treatment, scales = "free_x") +
labs(y="Count", fill = "Category")
metadata %>%
filter(!is.na(slowburn_heatstress_tank)) #163 corals
metadata %>%
filter(!is.na(slowburn_heatstress_tank)) %>%
select(Species:heatstress_recovery_tank) %>%
mutate(CBASS_temp = case_when(CBASS_tank == "1" ~ "36",
CBASS_tank == "2" ~ "37",
CBASS_tank == "3" ~ "32",
CBASS_tank == "4" ~ "33",
CBASS_tank == "5" ~ "35",
CBASS_tank == "6" ~ "30",
CBASS_tank == "7" ~ "34",
CBASS_tank == "8" ~ "28")) %>%
mutate(slowburn= case_when(slowburn_heatstress_tank == "7" ~ "ambient",
TRUE ~ "heatstress_32")) -> slowburn_metadata
slowburn_metadata %>%
filter(Removed_Date >= "2022-06-21" | is.na(Removed_Date)) %>%
mutate(Removed_Date = ymd(Removed_Date)) %>%
mutate(mortality_date = ymd(mortality_date)) %>%
mutate(end_date = coalesce(Removed_Date, mortality_date)) %>% #if removed_date is NA, then look and use the date from mortality date
mutate(start_date="2022-06-25") %>%
mutate(start_date = ymd(start_date)) %>%
mutate(days_to_removed = end_date - start_date) %>%
mutate(Reason_removed = case_when(Reason_removed == "dead" ~ "RTL",
Reason_removed == "RTL" ~ "RTL",
Reason_removed == "paling" ~ "bleached",
Reason_removed == "bleaching" ~ "bleached"))  %>%
group_by(Species, Treatment, Reason_removed) %>%
summarise(count = n())
slowburn_metadata %>%
filter(slowburn == "heatstress_32") %>%
filter(Removed_Date >= "2022-06-25" | is.na(Removed_Date)) %>%
mutate(Removed_Date = ymd(Removed_Date)) %>%
mutate(start_date="2022-06-25") %>%
mutate(start_date = ymd(start_date)) %>%
mutate(days_to_removed = Removed_Date - start_date) %>%
filter(!days_to_removed == "NA days") %>%
ggplot(., aes(x=Treatment, y=days_to_removed, fill = Treatment)) +
geom_boxplot() +
facet_wrap(~Species)
slowburn_metadata %>%
filter(slowburn == "heatstress_32") %>%
filter(Removed_Date >= "2022-06-25" | is.na(Removed_Date)) %>%
mutate(Removed_Date = ymd(Removed_Date)) %>%
mutate(start_date="2022-06-25") %>%
mutate(start_date = ymd(start_date)) %>%
mutate(days_to_removed = Removed_Date - start_date) %>%
filter(!days_to_removed == "NA days") %>%
group_by(Species, Treatment, CBASS_temp) %>%
summarise(averagedays = mean(days_to_removed), se = std.error(days_to_removed)) %>%
ggplot(., aes(x = CBASS_temp, y = averagedays, fill = Treatment)) +
geom_bar(stat="identity", position = position_dodge()) +
geom_errorbar(aes(ymin = averagedays - se, ymax = averagedays + se), width =
.2, position=position_dodge(.9)) +
theme_classic() +
facet_wrap(~Species, scales = "free_x") +
scale_fill_manual(labels=c("Treated", "Untreated"), values = c("#F54A34", "#60DBDB")) +
labs(x="CBASS Temperature", y="Number of Days at 32ºC")
#ggsave("daysat32_byCBASS.pdf")
slowburn_metadata %>%
filter(slowburn == "heatstress_32") %>%
filter(Removed_Date >= "2022-06-25" | is.na(Removed_Date)) %>%
mutate(Removed_Date = ymd(Removed_Date)) %>%
mutate(start_date="2022-06-25") %>%
mutate(start_date = ymd(start_date)) %>%
mutate(days_to_removed = Removed_Date - start_date)
slowburn_metadata %>%
filter(slowburn == "heatstress_32") %>%
filter(Removed_Date >= "2022-06-25" | is.na(Removed_Date)) %>%
mutate(Removed_Date = ymd(Removed_Date)) %>%
mutate(start_date="2022-06-25") %>%
mutate(start_date = ymd(start_date)) %>%
mutate(days_to_removed = Removed_Date - start_date) %>%
filter(!days_to_removed == "NA days") %>%
group_by(Species, Treatment, CBASS_temp) %>%
summarise(averagedays = mean(days_to_removed), se = std.error(days_to_removed))
slowburn_metadata %>%
filter(slowburn == "heatstress_32") %>%
filter(Removed_Date >= "2022-06-25" | is.na(Removed_Date)) %>%
mutate(Removed_Date = ymd(Removed_Date)) %>%
mutate(start_date="2022-06-25") %>%
mutate(start_date = ymd(start_date)) %>%
mutate(days_to_removed = Removed_Date - start_date) %>%
filter(!days_to_removed == "NA days") %>%
group_by(Species, Treatment, CBASS_temp) %>%
summarise(averagedays = mean(days_to_removed), se = std.error(days_to_removed)) %>%
ggplot(., aes(x = CBASS_temp, y = averagedays, fill = Treatment)) +
geom_bar(stat="identity", position = position_dodge()) +
geom_errorbar(aes(ymin = averagedays - se, ymax = averagedays + se), width =
.2, position=position_dodge(.9)) +
theme_classic() +
facet_wrap(~Species, scales = "free_x") +
scale_fill_manual(labels=c("Treated", "Untreated"), values = c("#F54A34", "#60DBDB")) +
labs(x="CBASS Temperature", y="Number of Days at 32ºC")
