---
title: "CBASS_DRC_modeling"
author: "allyson_demerlis"
date: "2023-12-22"
output: html_document
---

# Packages

```{r}
library(tidyverse)
library(plotrix)
library(glmmTMB)
library(emmeans)
library(lme4)
library(ggpubr)
library(drc) #for the function "drm" dose-response model
library(broom) #for the tidy function needed for dose response model
library(car)
library(rstatix)
library(rcompanion)
library(nlme)
library(multcomp)
library(MASS)
library(cowplot)
library(dunn.test)
```

# Import and tidy data

```{r}
ipam_tidy_data <- read.csv("ipam_tidy_data.csv")

ipam_tidy_data %>% 
  dplyr::filter(Treatment_period == "CBASS") %>% 
  dplyr::select(!Treatment) -> ipam_tidy_CBASS

ipam_tidy_data %>% 
  dplyr::filter(!Treatment_period == "CBASS") %>% 
  dplyr::select(Tank, Puck, Colony, Treatment, Species) %>% 
  distinct() %>% #283 rows = one coral ID per treatment, no repeats
  mutate(Treatment = case_when(Tank == "1" ~ "Untreated",
                               Tank == "2" ~ "Treated",
                               Tank == "3" ~ "Treated",
                               Tank == "4" ~ "Untreated",
                               Tank == "5" ~ "Treated", 
                               Tank == "6" ~ "Untreated",
                               Tank == "7" ~ "Untreated",
                               Tank == "8" ~ "tank_8")) %>% 
  full_join(ipam_tidy_CBASS, by = c("Puck", "Colony", "Species")) %>% 
  drop_na() %>% 
  rename(Treatment_Tank = Tank.x, CBASS_Tank = Tank.y) %>% 
  dplyr::select(-c("X", "AOI", "Ft", "Fm", "file")) -> ipam_tidy_CBASS_treatments

```

sample sizes - they're no longer balanced for Acer because of the treated vs. tank 8 separation
```{r}
ipam_tidy_CBASS_treatments %>% 
  mutate(CBASS_Tank = as.factor(CBASS_Tank)) %>% 
  group_by(Treatment, Colony, Species, CBASS_Tank) %>% 
  summarise(count = n()) %>% 
  ggplot(., aes(x=CBASS_Tank, y=count, fill = Treatment)) + 
  geom_bar(stat="identity", position = position_dodge()) +
  facet_wrap(~Species+Colony)
```

# Species x Treatment

## boxplot
```{r}
ipam_tidy_CBASS_treatments %>% 
  mutate(CBASS_temp = as.factor(CBASS_temp)) %>% 
  ggplot(., aes(x=CBASS_temp, y= fvfm, fill = Treatment)) + 
  scale_fill_manual(labels=c("Tank 8", "Treated", "Untreated"), values = c("grey", "#F54A34", "#60DBDB")) +
  geom_boxplot() +
  facet_wrap(~Species) + 
  theme_classic()
```

## curve
```{r}
ipam_tidy_CBASS_treatments %>%  
ggplot(., aes(x=CBASS_temp, y = fvfm, color = Treatment)) +
  geom_point() +
  scale_color_manual(labels=c("Tank 8", "Treated", "Untreated"), values = c("grey", "#F54A34", "#60DBDB")) +
  geom_smooth(formula = y ~ x, method = "loess", span = 0.9)  + 
  facet_wrap(~Species) +
  theme_classic() +
  labs(x="Temperature (ºC)", y = "Fv/Fm")
```

## DRC Curve fitting

Convert to factors
```{r}
str(ipam_tidy_CBASS_treatments)
#make factors: Colony, Puck, Treatment, Species

ipam_tidy_CBASS_treatments %>% 
  mutate_at(vars(Colony, Puck, Treatment, Species), factor) -> ipam_tidy_CBASS_treatments

#check
str(ipam_tidy_CBASS_treatments)
```


```{r}
# Checking sample sizes
aggregate(fvfm ~ Species + Treatment, data=ipam_tidy_CBASS_treatments, length)
#sample sizes are large enough to use z-test statistics from compParm()

aggregate(fvfm ~ Species + Treatment + Colony, data=ipam_tidy_CBASS_treatments, length)
```


```{r}
ipam_tidy_CBASS_treatments$Species_Treatment <- interaction(ipam_tidy_CBASS_treatments$Species, ipam_tidy_CBASS_treatments$Treatment)

ipam_tidy_CBASS_treatments$CBASS_temp <- as.numeric(ipam_tidy_CBASS_treatments$CBASS_temp) #needs to be numeric or drm function won't run


DRC_species_treatment = drm(fvfm ~ CBASS_temp, data = ipam_tidy_CBASS_treatments, curveid = Species_Treatment,
             fct = LL.3(names = c('hill', 'max', 'ed50')))
summary(DRC_species_treatment)
plot(DRC_species_treatment)

#See example 3 from the supplementary info of drc package creators Ritz et al. 2015 (https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0146021)

#compParm compares the selected coefficient by means of a z-test
compParm(DRC_species_treatment, 'ed50')
as.data.frame(compParm(DRC_species_treatment, 'ed50', "-")) %>% 
  write.csv("DRC_species_treatment_ed50_stats.csv")

compParm(DRC_species_treatment, 'hill')
as.data.frame(compParm(DRC_species_treatment, 'hill', "-")) %>% 
  write.csv("DRC_species_treatment_hill_stats.csv")

#use these p-values for the boxplot statistics
```


### ED50s
```{r}
coeff <- as.data.frame(DRC_species_treatment$coefficients) #hill, max, and ed50 values

coeff %>% 
  rownames_to_column(var = "coeff_species_treatment") %>% 
  filter(grepl("ed50", coeff_species_treatment)) -> ED50s

ED50s
```

Make predicted datasets for each species x treatment interaction

Acer
```{r}
untreated_Acer <- drm(fvfm ~ CBASS_temp, data = ipam_tidy_CBASS_treatments[ipam_tidy_CBASS_treatments$Species == "Acervicornis" & ipam_tidy_CBASS_treatments$Treatment=="Untreated",], fct = LL.3())
summary(untreated_Acer)
plot(untreated_Acer)

treated_Acer <- drm(fvfm ~ CBASS_temp, data = ipam_tidy_CBASS_treatments[ipam_tidy_CBASS_treatments$Species == "Acervicornis" & ipam_tidy_CBASS_treatments$Treatment=="Treated",], fct = LL.3())
summary(treated_Acer)
plot(treated_Acer)

tank8_Acer <- drm(fvfm ~ CBASS_temp, data = ipam_tidy_CBASS_treatments[ipam_tidy_CBASS_treatments$Species == "Acervicornis" & ipam_tidy_CBASS_treatments$Treatment=="tank_8",], fct = LL.3())
summary(tank8_Acer)
plot(tank8_Acer)

untreated_Acer_preddata = data.frame(temp = seq(27,39, length.out = 100))
untreated_Acer_pred = as.data.frame(predict(untreated_Acer, newdata = untreated_Acer_preddata, interval = 'confidence'))
untreated_Acer_preddata = data.frame(untreated_Acer_preddata, fvfm = untreated_Acer_pred$Prediction, Lower = untreated_Acer_pred$Lower, Upper = untreated_Acer_pred$Upper)

treated_Acer_preddata = data.frame(temp = seq(27,39, length.out = 100))
treated_Acer_pred = as.data.frame(predict(treated_Acer, newdata = treated_Acer_preddata, interval = 'confidence'))
treated_Acer_preddata = data.frame(treated_Acer_preddata, fvfm = treated_Acer_pred$Prediction, Lower = treated_Acer_pred$Lower, Upper = treated_Acer_pred$Upper)

tank8_Acer_preddata = data.frame(temp = seq(27,39, length.out = 100))
tank8_Acer_pred = as.data.frame(predict(tank8_Acer, newdata = tank8_Acer_preddata, interval = 'confidence'))
tank8_Acer_preddata = data.frame(tank8_Acer_preddata, fvfm = tank8_Acer_pred$Prediction, Lower = tank8_Acer_pred$Lower, Upper = tank8_Acer_pred$Upper)
```

plot
```{r}
g1 <- ggplot() +
  geom_jitter(data = ipam_tidy_CBASS_treatments[ipam_tidy_CBASS_treatments$Species == "Acervicornis",], aes(x = CBASS_temp, y = fvfm, color =   Treatment), size = 1, width = 0.25) +
  scale_x_continuous(limits=c(26,40), breaks=c(26,28,30,32,34,36,38)) +
  scale_y_continuous(limits=c(-0.1, 0.7), breaks=c(0, 0.2, 0.4, 0.6)) +
  geom_line(data = tank8_Acer_preddata, aes(x = temp, y = fvfm), color = 'black', show.legend = FALSE) +
  geom_ribbon(data = tank8_Acer_preddata, aes(x = temp, ymin=Lower, ymax=Upper), color = 'black', linetype=2, alpha = 0.2) +
  geom_vline(data = ED50s, aes(xintercept = 36.11790), color = 'grey', show.legend = FALSE) +
  geom_text(data = ED50s, aes(label = "ED50 = 36.12"), x = 38, y = 0.7, show.legend = FALSE, color = 'black') +
  geom_line(data = untreated_Acer_preddata, aes(x = temp, y = fvfm), color = "#60DBDB", show.legend = FALSE) +
  geom_ribbon(data = untreated_Acer_preddata, aes(x = temp, ymin=Lower, ymax=Upper), color = "#60DBDB", linetype=2, alpha = 0.2) +
  geom_vline(data = ED50s, aes(xintercept = 36.15546), color = "#60DBDB", show.legend = FALSE) +
  geom_text(data = ED50s, aes(label = "ED50 = 36.16"), x = 38, y = 0.65, show.legend = FALSE, color = "#60DBDB") +
  geom_line(data = treated_Acer_preddata, aes(x = temp, y = fvfm), color = '#F54A34', show.legend = FALSE) +
  geom_ribbon(data = treated_Acer_preddata, aes(x = temp, ymin=Lower, ymax=Upper), color = '#F54A34', linetype=2, alpha = 0.2) +
  geom_vline(data = ED50s, aes(xintercept = 36.24109), color = '#F54A34', show.legend = FALSE) +
  geom_text(data = ED50s, aes(label = "ED50 = 36.24"), x = 38, y = 0.6, show.legend = FALSE, color = '#F54A34') +
  scale_color_manual(labels=c("Tank 8", "Treated", "Untreated"), values = c("black", "#F54A34", "#60DBDB")) +
  ylab("Fv/Fm") +
  xlab("Temperature (°C)") +
  theme_bw() +
  labs(title = "A.cervicornis")
```


Pcli
```{r}
untreated_Pcli <- drm(fvfm ~ CBASS_temp, data = ipam_tidy_CBASS_treatments[ipam_tidy_CBASS_treatments$Species == "Pclivosa" & ipam_tidy_CBASS_treatments$Treatment=="Untreated",], fct = LL.3())
summary(untreated_Pcli)
plot(untreated_Pcli)

treated_Pcli <- drm(fvfm ~ CBASS_temp, data = ipam_tidy_CBASS_treatments[ipam_tidy_CBASS_treatments$Species == "Pclivosa" & ipam_tidy_CBASS_treatments$Treatment=="Treated",], fct = LL.3())
summary(treated_Pcli)
plot(treated_Pcli)

untreated_Pcli_preddata = data.frame(temp = seq(27,39, length.out = 100))
untreated_Pcli_pred = as.data.frame(predict(untreated_Pcli, newdata = untreated_Pcli_preddata, interval = 'confidence'))
untreated_Pcli_preddata = data.frame(untreated_Pcli_preddata, fvfm = untreated_Pcli_pred$Prediction, Lower = untreated_Pcli_pred$Lower, Upper = untreated_Pcli_pred$Upper)

treated_Pcli_preddata = data.frame(temp = seq(27,39, length.out = 100))
treated_Pcli_pred = as.data.frame(predict(treated_Pcli, newdata = treated_Pcli_preddata, interval = 'confidence'))
treated_Pcli_preddata = data.frame(treated_Pcli_preddata, fvfm = treated_Pcli_pred$Prediction, Lower = treated_Pcli_pred$Lower, Upper = treated_Pcli_pred$Upper)
```


plot
```{r}
g2<- ggplot() +
  geom_jitter(data = ipam_tidy_CBASS_treatments[ipam_tidy_CBASS_treatments$Species == "Pclivosa",], aes(x = CBASS_temp, y = fvfm, color = Treatment), size = 1, width = 0.25) +
  scale_x_continuous(limits=c(26,40), breaks=c(26,28,30,32,34,36,38)) +
  scale_y_continuous(limits=c(-0.1, 0.7), breaks=c(0, 0.2, 0.4, 0.6)) +
  geom_line(data = untreated_Pcli_preddata, aes(x = temp, y = fvfm), color = "#60DBDB", show.legend = FALSE) +
  geom_ribbon(data = untreated_Pcli_preddata, aes(x = temp, ymin=Lower, ymax=Upper), color = "#60DBDB", linetype=2, alpha = 0.2) +
  geom_vline(data = ED50s, aes(xintercept = 36.45646), color = "#60DBDB", show.legend = FALSE) +
  geom_text(data = ED50s, aes(label = "ED50 = 36.46"), x = 38, y = 0.65, show.legend = FALSE, color = "#60DBDB") +
  geom_line(data = treated_Pcli_preddata, aes(x = temp, y = fvfm), color = '#F54A34', show.legend = FALSE) +
  geom_ribbon(data = treated_Pcli_preddata, aes(x = temp, ymin=Lower, ymax=Upper), color = '#F54A34', linetype=2, alpha = 0.2) +
  geom_vline(data = ED50s, aes(xintercept = 36.52786), color = '#F54A34', show.legend = FALSE) +
  geom_text(data = ED50s, aes(label = "ED50 = 36.53"), x = 38, y = 0.6, show.legend = FALSE, color = '#F54A34') +
  scale_color_manual(labels=c("Treated", "Untreated"), values = c( "#F54A34", "#60DBDB")) +
  ylab("Fv/Fm") +
  xlab("Temperature (°C)") +
  theme_bw() +
  labs(title = "P.clivosa")
```


## Final DRC plots
```{r}
plot_grid(g1, g2)
ggsave("ED50_DRC_bothspecies.pdf", width = 15, height = 7)
```

# Colony x Treatment

## boxplot

```{r}
ipam_tidy_CBASS_treatments %>% 
  mutate(CBASS_temp = as.factor(CBASS_temp)) %>% 
  ggplot(., aes(x=CBASS_temp, y= fvfm, fill = Treatment)) + 
  scale_fill_manual(labels=c("Tank 8", "Treated", "Untreated"), values = c("grey", "#F54A34", "#60DBDB")) +
  geom_boxplot() +
  facet_wrap(~Species+Colony) +
  theme_classic()
```

## curve
```{r}
ipam_tidy_CBASS_treatments %>%  
  mutate(CBASS_temp=as.numeric(CBASS_temp)) %>% 
ggplot(., aes(x=CBASS_temp, y = fvfm, color = Treatment)) +
  geom_point() +
  scale_color_manual(labels=c("Tank 8", "Treated", "Untreated"), values = c("grey", "#F54A34", "#60DBDB")) +
  geom_smooth(formula = y ~ x, method = "loess", span = 0.9)  + 
  facet_wrap(~Species+Colony) +
  theme_classic() +
  labs(x="Temperature (ºC)", y = "Fv/Fm")
```

## DRC Curve fitting

Acer
```{r}
ipam_tidy_CBASS_treatments %>% 
  filter(Species == "Acervicornis") -> Acer_CBASS

Acer_CBASS$Colony_Treatment <- interaction(Acer_CBASS$Colony, Acer_CBASS$Treatment)

str(Acer_CBASS)

DRC_Acer_colony_treatment = drm(fvfm ~ CBASS_temp, data = Acer_CBASS, curveid = Colony_Treatment,
             fct = LL.3(names = c('hill', 'max', 'ed50')))
summary(DRC_Acer_colony_treatment)
plot(DRC_Acer_colony_treatment)
compParm(DRC_Acer_colony_treatment, 'ed50')
compParm(DRC_Acer_colony_treatment, 'ed50', "-")

compParm(DRC_Acer_colony_treatment, 'hill')
compParm(DRC_Acer_colony_treatment, 'hill', "-")

Acer_coeff <- as.data.frame(DRC_Acer_colony_treatment$coefficients)

Acer_coeff %>% 
  rownames_to_column(var = "coeff_colony_treatment") %>% 
  filter(grepl("ed50", coeff_colony_treatment)) %>% 
  rename(ED50 = `DRC_Acer_colony_treatment$coefficients`) %>% 
  separate(coeff_colony_treatment, into=c("ed50", "Colony", "Treatment"), sep = "[:.]") -> Acer_ED50s

#statistics
Acer_model <- lm(ED50 ~ Treatment, data = Acer_ED50s)
Acer_model_metrics <- augment(Acer_model)

# assess normality of residuals using Shapiro-Wilk test
shapiro_test(Acer_model_metrics$.resid) # not significant

# assess homogeneity of variances using Levene's Test
levene_test(.resid ~ Treatment, data = Acer_model_metrics) #not significant

Acer_aov <- aov(ED50 ~ Treatment, data = Acer_ED50s)
summary(Acer_aov) #not significant
```

Pcli
```{r}
ipam_tidy_CBASS_treatments %>% 
  filter(Species == "Pclivosa") -> Pcli_CBASS

Pcli_CBASS$Colony_Treatment <- interaction(Pcli_CBASS$Colony, Pcli_CBASS$Treatment)

str(Pcli_CBASS)

DRC_Pcli_colony_treatment = drm(fvfm ~ CBASS_temp, data = Pcli_CBASS, curveid = Colony_Treatment,
             fct = LL.3(names = c('hill', 'max', 'ed50')))
summary(DRC_Pcli_colony_treatment)
plot(DRC_Pcli_colony_treatment)
compParm(DRC_Pcli_colony_treatment, 'ed50')
compParm(DRC_Pcli_colony_treatment, 'ed50', "-")

compParm(DRC_Pcli_colony_treatment, 'hill')
compParm(DRC_Pcli_colony_treatment, 'hill', "-")

Pcli_coeff <- as.data.frame(DRC_Pcli_colony_treatment$coefficients)

Pcli_coeff %>% 
  rownames_to_column(var = "coeff_colony_treatment") %>% 
  filter(grepl("ed50", coeff_colony_treatment)) %>% 
  rename(ED50 = `DRC_Pcli_colony_treatment$coefficients`) %>% 
  separate(coeff_colony_treatment, into=c("ed50", "Colony", "Treatment"), sep = "[:.]") -> Pcli_ED50s

#statistics
Pcli_model <- lm(ED50 ~ Treatment, data = Pcli_ED50s)
Pcli_model_metrics <- augment(Pcli_model)

# assess normality of residuals using Shapiro-Wilk test
shapiro_test(Pcli_model_metrics$.resid) # not significant

# assess homogeneity of variances using Levene's Test
levene_test(.resid ~ Treatment, data = Pcli_model_metrics) #not significant

Pcli_aov <- aov(ED50 ~ Treatment, data = Pcli_ED50s)
summary(Pcli_aov) #not significant
```

combine both ED50 datasets into one
```{r}
Pcli_ED50s %>% 
  mutate(Species ="Pclivosa") -> Pcli_ED50s

Acer_ED50s %>% 
  mutate(Species = "Acervicornis") -> Acer_ED50s

full_join(Pcli_ED50s, Acer_ED50s) -> bothspecies_colony_ED50s

bothspecies_colony_ED50s$Species_Treatment <- interaction(bothspecies_colony_ED50s$Species, bothspecies_colony_ED50s$Treatment)

ed50_model <- lm(ED50 ~ Species_Treatment, data = bothspecies_colony_ED50s)
ed50_model_metrics <- augment(ed50_model)

summary(glht(ed50_model, linfct=mcp(Species_Treatment="Tukey")), test = adjusted(type = "bonferroni"))

# assess normality of residuals using Shapiro-Wilk test
shapiro_test(ed50_model_metrics$.resid) # not significant

# assess homogeneity of variances using Levene's Test
levene_test(.resid ~ Species_Treatment, data = ed50_model_metrics) #not significant

summary(aov(ED50 ~ Species_Treatment, data = bothspecies_colony_ED50s)) #not significant

TukeyHSD(aov(ED50 ~ Species_Treatment, data = bothspecies_colony_ED50s))

# i don't understand how these aren't significant... maybe ANOVA isn't the right test because the design is unbalanced? Acer has 3 treatments and Pcli has 2. also number of sample sizes varies for each group.

#let's try a non parametric test that is robust to unbalanced designs

kruskal.test(ED50 ~ Species_Treatment, data = bothspecies_colony_ED50s) #not significant

```

## boxplot of ed50s
```{r}
#something fishy is going on with these ED50s. the means don't match the drc ones??
ggplot(bothspecies_colony_ED50s, aes(x=Treatment, y=ED50, fill=Treatment)) +
  geom_boxplot() +
  facet_wrap(~Species, scales = "free_x") +
  scale_fill_manual(labels=c("Tank 8", "Treated", "Untreated"), values = c("grey", "#F54A34", "#60DBDB")) +
  theme_classic() +
  theme(text = element_text(size = 12)) 
ggsave("ed50s_boxplot_bothspecies.pdf", width = 7, height =5)
```


## statistics for hill slope of curve
```{r}
Acer_coeff %>% 
  rownames_to_column(var = "coeff_colony_treatment") %>% 
  filter(grepl("hill", coeff_colony_treatment)) %>% 
  rename(hill = `DRC_Acer_colony_treatment$coefficients`) %>% 
  separate(coeff_colony_treatment, into=c("var", "Colony", "Treatment"), sep = "[:.]") -> Acer_hills

#statistics
Acer_hill_model <- lm(hill ~ Treatment, data = Acer_hills)
Acer_hill_model_metrics <- augment(Acer_hill_model)

# assess normality of residuals using Shapiro-Wilk test
shapiro_test(Acer_hill_model_metrics$.resid) # not significant

# assess homogeneity of variances using Levene's Test
levene_test(.resid ~ Treatment, data = Acer_hill_model_metrics) #not significant

summary(aov(hill ~ Treatment, data = Acer_hills)) #not significant
```

```{r}
Pcli_coeff %>% 
  rownames_to_column(var = "coeff_colony_treatment") %>% 
  filter(grepl("hill", coeff_colony_treatment)) %>% 
  rename(hill = `DRC_Pcli_colony_treatment$coefficients`) %>% 
  separate(coeff_colony_treatment, into=c("var", "Colony", "Treatment"), sep = "[:.]") -> Pcli_hills

#statistics
Pcli_hill_model <- lm(hill ~ Treatment, data = Pcli_hills)
Pcli_hill_model_metrics <- augment(Pcli_hill_model)

# assess normality of residuals using Shapiro-Wilk test
shapiro_test(Pcli_hill_model_metrics$.resid) # not significant

# assess homogeneity of variances using Levene's Test
levene_test(.resid ~ Treatment, data = Pcli_hill_model_metrics) #not significant

summary(aov(hill ~ Treatment, data = Pcli_hills)) #not significant
```

combine both hill datasets into one
```{r}
Pcli_hills %>% 
  mutate(Species ="Pclivosa") -> Pcli_hills

Acer_hills %>% 
  mutate(Species = "Acervicornis") -> Acer_hills

full_join(Pcli_hills, Acer_hills) -> bothspecies_colony_hills

bothspecies_colony_hills$Species_Treatment <- interaction(bothspecies_colony_hills$Species, bothspecies_colony_hills$Treatment)

hill_model <- lm(hill ~ Species_Treatment, data = bothspecies_colony_hills)
hill_model_metrics <- augment(hill_model)

summary(glht(hill_model, linfct=mcp(Species_Treatment="Tukey")), test = adjusted(type = "bonferroni"))

# assess normality of residuals using Shapiro-Wilk test
shapiro_test(hill_model_metrics$.resid) # not significant

# assess homogeneity of variances using Levene's Test
levene_test(.resid ~ Species_Treatment, data = hill_model_metrics) #not significant

summary(aov(hill ~ Species_Treatment, data = bothspecies_colony_hills)) #not significant

TukeyHSD(aov(hill ~ Species_Treatment, data = bothspecies_colony_hills))

# i don't understand how these aren't significant... maybe ANOVA isn't the right test because the design is unbalanced? Acer has 3 treatments and Pcli has 2. also number of sample sizes varies for each group.

#let's try a non parametric test that is robust to unbalanced designs

kruskal.test(hill ~ Species_Treatment, data = bothspecies_colony_hills) #significant!
dunn.test(bothspecies_colony_hills$hill, bothspecies_colony_hills$Species_Treatment, method = "bonferroni") # no significant interactions
```


## boxplot of hills
```{r}
ggplot(bothspecies_colony_hills, aes(x=Treatment, y=hill, fill=Treatment)) +
  geom_boxplot() +
  facet_wrap(~Species, scales = "free_x") +
  scale_fill_manual(labels=c("Tank 8", "Treated", "Untreated"), values = c("grey", "#F54A34", "#60DBDB")) +
  theme_classic() +
  theme(text = element_text(size = 12)) 
#ggsave("hills_boxplot_bothspecies.pdf", width = 7, height =5)
```